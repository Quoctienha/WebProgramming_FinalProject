<div class="container mt-4">
    <h2>Thêm bài viết mới</h2>
    <hr>
    <!-- Form for adding a new post -->
    <form method="POST" action="/writer/add" id="addPostForm">
        <div class="form-group mb-2">
            <label for="PostTitle">Tiêu đề bài viết</label>
            <input type="text" name="PostTitle" id="PostTitle" class="form-control" required>
        </div>
        <div class="form-group mb-2">
            <label for="CID">Danh mục</label>
            <select name="CID" id="CID" class="form-control" required>
                <option value="">Chọn danh mục</option>
                {{#each categories}}
                <option value="{{this.CID}}">{{this.CName}}</option>
                {{/each}}
            </select>
        </div>
        <div class="form-group mb-2">
            <label for="SCID">Chuyên mục phụ</label>
            <select name="SCID" id="SCID" class="form-control">
                <option value="">Chọn chuyên mục phụ</option>
            </select>
        </div>
        <script>
            const subcategories = [
                {{#each subcategories}}
                { CID: "{{this.CID}}", SCID: "{{this.SCID}}", SCName: "{{this.SCName}}" },
                {{/each}}
            ];
            document.getElementById('CID').addEventListener('change', function() {
                const selectedCID = this.value;
                const subcategorySelect = document.getElementById('SCID');
                subcategorySelect.innerHTML = '<option value="">Chọn chuyên mục phụ</option>';
                subcategories.forEach(function(subcategory) {
                    if (subcategory.CID === selectedCID) {
                        const option = document.createElement('option');
                        option.value = subcategory.SCID;
                        option.text = subcategory.SCName;
                        subcategorySelect.appendChild(option);
                    }
                });
            });
        </script>
        <div class="form-group mb-2">
            <label for="SumContent">Tóm tắt nội dung</label>
            <textarea name="SumContent" id="SumContent" class="form-control" required></textarea>
        </div>
        <div class="form-group mb-2">
            <label for="Content">Nội dung bài viết</label>
            <div id="ContentEditor" class="form-control" required></div>
        </div>
        <input type="hidden" name="Content" id="Content">
        <div class="form-group mb-2">
            <label for="source">Nguồn</label>
            <input type="text" name="source" id="source" class="form-control">
        </div>
        <div class="form-group mb-2">
            <label for="linksource">Link nguồn</label>
            <input type="text" name="linksource" id="linksource" class="form-control">
        </div>
        <div class="form-group mb-2">
            <label for="view">Lượt xem</label>
            <input type="number" name="view" id="view" class="form-control" value="0" readonly>
        </div>
        <div class="form-group mb-2">
            <label for="Reason">Lý do</label>
            <input type="text" name="Reason" id="Reason" class="form-control">
        </div>
        <div class="form-group mb-2">
            <label for="TimePublic">Thời gian công khai</label>
            <input type="datetime-local" name="TimePublic" id="TimePublic" class="form-control">
        </div>
        <div class="form-group mb-2">
            <label for="Premium">Premium</label>
            <input type="number" name="Premium" id="Premium" class="form-control" value="0" min="0">
        </div>
        <button type="submit" class="btn btn-success">Thêm bài viết</button>
    </form>
</div>
<script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>
<script>
    let editor;
    ClassicEditor.create(document.querySelector('#ContentEditor'))
        .then(newEditor => {
            editor = newEditor;
        })
        .catch(error => {
            console.error("Error initializing CKEditor:", error);
        });
    document.getElementById('addPostForm').addEventListener('submit', function (event) {
        if (editor) {
            const contentData = editor.getData();
            document.getElementById('Content').value = contentData;
        }
    });
</script>
