{{#section 'css'}}
    <script src="https://cdn.ckeditor.com/ckeditor5/36.0.1/classic/ckeditor.js"></script>
{{/section}}
{{#section 'js'}}
<script>
    const subcategories = [
        {{#each subcategories}}
        { CID: "{{this.CID}}", SCID: "{{this.SCID}}", SCName: "{{this.SCName}}" },
        {{/each}}
    ];
    document.getElementById('CID').addEventListener('change', function() {
        const selectedCID = this.value;
        const subcategorySelect = document.getElementById('SCID');
        subcategorySelect.innerHTML = '<option value="">Chọn chuyên mục phụ</option>';
        subcategories.forEach(function(subcategory) {
            if (subcategory.CID === selectedCID) {
                const option = document.createElement('option');
                option.value = subcategory.SCID;
                option.text = subcategory.SCName;
                subcategorySelect.appendChild(option);
            }
        });
    });
</script>

<script>
    let editorContent, editorSummary;

// Initialize CKEditor for ContentEditor
ClassicEditor.create(document.querySelector('#ContentEditor'))
    .then(newEditor => {
        editorContent = newEditor;
    })
    .catch(error => {
        console.error("Error initializing CKEditor for Content:", error);
    });

// Initialize CKEditor for SumContentEditor
ClassicEditor.create(document.querySelector('#SumContentEditor'))
    .then(newEditor => {
        editorSummary = newEditor;
    })
    .catch(error => {
        console.error("Error initializing CKEditor for Summary:", error);
    });

document.getElementById('addPostForm').addEventListener('submit', function (event) {
    // Prevent form submission if editors are not initialized
    if (!editorContent || !editorSummary) {
        event.preventDefault();
        alert('Vui lòng đợi trình chỉnh sửa nội dung tải xong.');
        return;
    }

    // Ensure data is captured from CKEditor before submission
    document.getElementById('Content').value = editorContent.getData();
    document.getElementById('SumContent').value = editorSummary.getData();
});

</script>

{{/section}}

<div class="card">
  <h3 class="card-header text-center bg bg-info text-white">Thêm bài viết mới</h3>
  <div class="card-body bg bg-light">
    <!-- Form for adding a new post -->
    <form method="POST" action="/writer/add" id="addPostForm">
        <div class="form-group mb-2">
            <label for="PostTitle">Tiêu đề bài viết</label>
            <input type="text" name="PostTitle" id="PostTitle" class="form-control" required>
        </div>
        <div class="form-group mb-2">
            <label for="CID">Danh mục</label>
            <select name="CID" id="CID" class="form-control" required>
                <option value="">Chọn danh mục</option>
                {{#each categories}}
                <option value="{{this.CID}}">{{this.CName}}</option>
                {{/each}}
            </select>
        </div>
        <div class="form-group mb-2">
            <label for="SCID">Chuyên mục phụ</label>
            <select name="SCID" id="SCID" class="form-control">
                <option value="">Chọn chuyên mục phụ</option>
            </select>
        </div>
       
        <div class="form-group mb-2">
            <label for="SumContent">Tóm tắt nội dung</label>
            <div id="SumContentEditor" class="form-control" required></div>
            <input type="hidden" name="SumContent" id="SumContent">
        </div>

        <div class="form-group mb-2">
            <label for="Content">Nội dung bài viết</label>
            <div id="ContentEditor" class="form-control" required></div>
            <input type="hidden" name="Content" id="Content">
        </div>


        <button type="submit" class="btn btn-success">Thêm bài viết</button>
    </form>
  </div>
</div>




