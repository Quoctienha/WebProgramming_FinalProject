<h2 style=" text-align: center">Danh sách bài viết </h2>

<!-- Buttons to toggle between drafts -->
<div class="btn-group">
  <button id="showDrafts" class="btn btn-secondary w-100">
    Bài viết chờ duyệt
  </button>
  <button id="showDrafts2" class="btn btn-secondary w-100">
    Bài viết chờ xuất bản
  </button>
  <button id="showDrafts3" class="btn btn-secondary w-100">
    Bài viết đã xuất bản
  </button>
  <button id="showDrafts4" class="btn btn-secondary w-100">
    Bài viết bị từ chối
  </button>
</div>

<!-- Drafts Section -->
<div id="draftsSection" class="drafts-table">
  {{#if drafts.length}}
    <table style="border-collapse: collapse; width: 100%; border: 1px solid #ddd;">
      <thead>
        <tr style="background-color: #f2f2f2; text-align: center; vertical-align: middle;">
          <th style="border: 1px solid #ddd; padding: 8px;">Tiêu đề</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chuyên mục</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Tác giả</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Hành động</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chi tiết</th>

        </tr>
      </thead>
      <tbody>
        {{#each drafts}}
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">{{this.PostTitle}}</td>
            <td style="border: 1px solid #ddd;text-align: center; padding: 8px;">{{this.CName}}</td>
            <td style="border: 1px solid #ddd; text-align: center;padding: 8px;">{{this.UserName}}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
              <button 
                onclick="approvePost({{this.PostID}})" 
                class="btn btn-success btn-sm">
                Duyệt
              </button>
              <button 
                onclick="rejectPost({{this.PostID}})" 
                class="btn btn-danger btn-sm">
                Từ chối
              </button>

            </td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
              <button 
                class="btn btn-info btn-sm" 
                data-content="{{this.Content}}" 
                onclick="viewContent(this)">
                Xem nội dung
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p>Không có bài viết nào cần duyệt.</p>
  {{/if}}
</div>

<!-- Accepted Posts Section -->
<div id="drafts2Section" class="drafts-table" style="display: none;">
  <h3>Accepted Posts</h3>
  {{#if drafts2.length}}
    <table style="border-collapse: collapse; width: 100%; border: 1px solid #ddd;">
      <thead>
        <tr style="background-color: #f2f2f2; text-align: center; vertical-align: middle;">
          <th style="border: 1px solid #ddd; padding: 8px;">Tiêu đề</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chuyên mục</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Tác giả</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chi tiết</th>

        </tr>
      </thead>
      <tbody>
        {{#each drafts2}}
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">{{this.PostTitle}}</td>
            <td style="border: 1px solid #ddd;text-align: center; padding: 8px;">{{this.CName}}</td>
            <td style="border: 1px solid #ddd; text-align: center;padding: 8px;">{{this.UserName}}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
              <button 
                class="btn btn-info btn-sm" 
                data-content="{{this.Content}}" 
                onclick="viewContent(this)">
                Xem nội dung
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p>Không có bài viết nào đang đợi xuất bản</p>
  {{/if}}
</div>

<!-- Exported Posts Section -->
<div id="drafts3Section" class="drafts-table" style="display: none;">
  <h3>Exported Posts</h3>
  {{#if drafts3.length}}
    <table style="border-collapse: collapse; width: 100%; border: 1px solid #ddd;">
      <thead>
        <tr style="background-color: #f2f2f2; text-align: center; vertical-align: middle;">
          <th style="border: 1px solid #ddd; padding: 8px;">Tiêu đề</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chuyên mục</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Tác giả</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chi tiết</th>

        </tr>
      </thead>
      <tbody>
        {{#each drafts3}}
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">{{this.PostTitle}}</td>
            <td style="border: 1px solid #ddd;text-align: center; padding: 8px;">{{this.CName}}</td>
            <td style="border: 1px solid #ddd; text-align: center;padding: 8px;">{{this.UserName}}</td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
              <button 
                class="btn btn-info btn-sm" 
                data-content="{{this.Content}}" 
                onclick="viewContent(this)">
                Xem nội dung
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p>Không có bài viết nào.</p>
  {{/if}}
</div>
<!-- Rejected Posts Section -->
<div id="drafts4Section" class="drafts-table" style="display: none;">
  <h3>Bài viết bị từ chối</h3>
  {{#if drafts4.length}}
    <table style="border-collapse: collapse; width: 100%; border: 1px solid #ddd;">
      <thead>
        <tr style="background-color: #f2f2f2; text-align: center; vertical-align: middle;">
          <th style="border: 1px solid #ddd; padding: 8px;">Tiêu đề</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chuyên mục</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Tác giả</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Hành động</th>
          <th style="border: 1px solid #ddd; padding: 8px;">Chi tiết</th>

        </tr>
      </thead>
      <tbody>
        {{#each drafts4}}
          <tr>
            <td style="border: 1px solid #ddd; padding: 8px;">{{this.PostTitle}}</td>
            <td style="border: 1px solid #ddd;text-align: center; padding: 8px;">{{this.CName}}</td>
            <td style="border: 1px solid #ddd; text-align: center;padding: 8px;">{{this.UserName}}</td>
             <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
              <button 
                onclick="approvePost({{this.PostID}})" 
                class="btn btn-success btn-sm">
                Duyệt
              </button>
            </td>
            <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">
              <button 
                class="btn btn-info btn-sm" 
                data-content="{{this.Content}}" 
                onclick="viewContent(this)">
                Xem nội dung
              </button>
            </td>
          </tr>
        {{/each}}
      </tbody>
    </table>
  {{else}}
    <p>Không có bài viết nào bị từ chối.</p>
  {{/if}}
</div>
<div id="selectedPostContent" style="margin-top: 20px; border: 1px solid #ddd; padding: 10px; display: none;">
  <button onclick="hideContent()" class="btn btn-secondary btn-sm" style="float: right;">Ẩn</button>
  <h3>Nội dung bài viết</h3>
  <p id="postContent">Chưa có nội dung được chọn.</p>
</div>

<script>
  // Event listeners for the buttons
  document.getElementById("showDrafts").addEventListener("click", () => toggleSection("draftsSection", "showDrafts"));
  document.getElementById("showDrafts2").addEventListener("click", () => toggleSection("drafts2Section", "showDrafts2"));
  document.getElementById("showDrafts3").addEventListener("click", () => toggleSection("drafts3Section", "showDrafts3"));
  document.getElementById("showDrafts4").addEventListener("click", () => toggleSection("drafts4Section", "showDrafts4"));


  /**
   * Toggles visibility of a section and updates the active button.
   * @param {string} sectionId - The ID of the section to show.
   * @param {string} buttonId - The ID of the button to highlight.
   */
  function toggleSection(sectionId, buttonId) {
    // Hide all sections
    const sections = document.querySelectorAll(".drafts-table");
    sections.forEach(section => section.style.display = "none");

    // Show the selected section
    document.getElementById(sectionId).style.display = "block";

    // Remove active state from all buttons
    const buttons = document.querySelectorAll(".btn-group .btn");
    buttons.forEach(button => {
      button.classList.remove("btn-primary", "active");
      button.classList.add("btn-secondary");
    });

    // Add active state to the clicked button
    const activeButton = document.getElementById(buttonId);
    activeButton.classList.add("btn-primary", "active");
    activeButton.classList.remove("btn-secondary");
  }
  async function approvePost(PostId) {
  alert("PostID sent: " + PostId);
  try {
    const response = await fetch("/editor/approve", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        PostID: PostId, // Ensure the key matches what the backend expects
      }),
    });

    if (response.ok) {
      alert("Bài viết đã được duyệt.");
      location.reload(); // Refresh the page
    } else {
      const message = await response.text();
      alert("Lỗi: " + message);
    }
  } catch (error) {
    console.error("Error approving post:", error);
    alert("Đã xảy ra lỗi khi duyệt bài viết.");
  }
}


  async function rejectPost(PostId) {
  alert("PostID sent: " + PostId);
  try {
    const response = await fetch("/editor/reject", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        PostID: PostId, // Ensure the key matches what the backend expects
      }),
    });

    if (response.ok) {
      alert("Bài viết đã bị từ chối.");
      location.reload(); // Refresh the page
    } else {
      const message = await response.text();
      alert("Lỗi: " + message);
    }
  } catch (error) {
    console.error("Error deny post:", error);
    alert("Đã xảy ra lỗi khi từ chối bài viết.");
  }
  }
  function toggleSection(sectionId, buttonId) {
    // Hide all sections
    const sections = document.querySelectorAll(".drafts-table");
    sections.forEach(section => section.style.display = "none");

    // Show the selected section
    document.getElementById(sectionId).style.display = "block";

    // Remove active state from all buttons
    const buttons = document.querySelectorAll(".btn-group .btn");
    buttons.forEach(button => {
      button.classList.remove("btn-primary", "active");
      button.classList.add("btn-secondary");
    });

    // Add active state to the clicked button
    const activeButton = document.getElementById(buttonId);
    activeButton.classList.add("btn-primary", "active");
    activeButton.classList.remove("btn-secondary");

    // Hide the content section
    hideContent();
  }
   function viewContent(button) {
    const content = button.getAttribute("data-content"); // Retrieve the content from the data attribute

    const contentSection = document.getElementById("selectedPostContent");
    const contentDiv = document.getElementById("postContent");

    if (content) {
      // Decode and display the web-formatted content
      contentDiv.innerHTML = content; // Use innerHTML to render HTML or rich text
      contentSection.style.display = "block"; // Make the content section visible
    } else {
      contentDiv.textContent = "Không có nội dung.";
      contentSection.style.display = "none";
    }
  }
  function hideContent() {
  const contentSection = document.getElementById("selectedPostContent");
  const contentDiv = document.getElementById("postContent");

  contentDiv.innerHTML = ""; // Clear content
  contentSection.style.display = "none"; // Hide the section
}

</script>

<style>
  /* Make sure all buttons are the same size and centered */
.btn-group {
  display: flex;
  justify-content: center;  /* Center buttons horizontally */
  width: 100%;
}

.btn-group .btn {
  flex: 1;                  /* Make all buttons take equal space */
  text-align: center;       /* Center text inside each button */
  transition: background-color 0.3s ease, color 0.3s ease;
}

/* Active button style */
.btn-group .btn.active {
  background-color: #0056b3;
  border-color: #0056b3;
  color: white;
}

/* Optional: Styling for inactive buttons */
.btn-group .btn:not(.active) {
  background-color: #6c757d;
  color: white;
}

</style>
